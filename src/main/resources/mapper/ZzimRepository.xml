<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.childprj.repository.ZzimRepository">

    <resultMap id="mapTogether" type="com.project.childprj.domain.Together">
        <result column="t_id" property="id"/>
        <result column="t_CODENAME" property="CODENAME"/>
        <result column="t_GUNAME" property="GUNAME"/>
        <result column="t_TITLE" property="TITLE"/>
        <result column="t_DATE" property="DATE"/>
        <result column="t_PLACE" property="PLACE"/>
        <result column="t_ORG_NAME" property="ORG_NAME"/>
        <result column="t_USE_TRGT" property="USE_TRGT"/>
        <result column="t_USE_FEE" property="USE_FEE"/>
        <result column="t_ORG_LINK" property="ORG_LINK"/>
        <result column="t_MAIN_IMG" property="MAIN_IMG"/>
        <result column="t_STRTDATE" property="STRTDATE"/>
        <result column="t_END_DATE" property="END_DATE"/>
        <result column="t_LOT" property="LOT"/>
        <result column="t_LAT" property="LAT"/>
        <result column="t_zzimCnt" property="zzimCnt"/>
    </resultMap>

    <resultMap id="mapZzim" type="com.project.childprj.domain.Zzim">
        <result column="z_id" property="id"/>
        <result column="z_userId" property="userId"/>
        <collection resultMap="mapTogether" property="together"/>
    </resultMap>

    <sql id="SELECT_BASE">
        SELECT
             z.id       "z_id"
             , z.userId   "z_userId"

             , t.id       "t_id"
             , t.CODENAME "t_CODENAME"
             , t.GUNAME   "t_GUNAME"
             , t.TITLE    "t_TITLE"
             , t.DATE     "t_DATE"
             , t.PLACE    "t_PLACE"
             , t.ORG_NAME "t_ORG_NAME"
             , t.USE_TRGT "t_USE_TRGT"
             , t.USE_FEE  "t_USE_FEE"
             , t.ORG_LINK "t_ORG_LINK"
             , t.MAIN_IMG "t_MAIN_IMG"
             , t.STRTDATE "t_STRTDATE"
             , t.END_DATE "t_END_DATE"
             , t.LOT      "t_LOT"
             , t.LAT      "t_LAT"
             , t.zzimCnt  "t_zzimCnt"
          FROM
             zzim z , together t
         WHERE z.togetherId = t.id
    </sql>

<!--    <resultMap id="mapTogether" type="com.project.childprj.domain.Together">-->
<!--        <result column="t_id" property="id"/>-->
<!--        <result column="t_TITLE" property="TITLE"/>-->
<!--        <result column="t_DATE" property="DATE"/>-->
<!--        <result column="t_MAIN_IMG" property="MAIN_IMG"/>-->
<!--        <result column="t_zzimCnt" property="zzimCnt"/>-->
<!--    </resultMap>-->

<!--    <resultMap id="mapZzim" type="com.project.childprj.domain.Zzim">-->
<!--        <result column="z_id" property="id"/>-->
<!--        <result column="z_userId" property="userId"/>-->
<!--        <collection resultMap="mapTogether" property="together"/>-->
<!--    </resultMap>-->

<!--    <sql id="SELECT_BASE">-->
<!--        SELECT-->
<!--             z.id       "z_id"-->
<!--             , z.userId   "z_userId"-->

<!--             , t.id       "t_id"-->
<!--             , t.TITLE    "t_TITLE"-->
<!--             , t.DATE     "t_DATE"-->
<!--             , t.MAIN_IMG "t_MAIN_IMG"-->
<!--             , t.zzimCnt  "t_zzimCnt"-->
<!--          FROM zzim z-->
<!--             , together t-->
<!--         WHERE z.togetherId = t.id-->
<!--    </sql>-->


    <select id="selectFromCnt" resultMap="mapZzim">
        <include refid="SELECT_BASE"/>
          AND z.userId = #{userId}
        ORDER BY z.id DESC
        LIMIT #{from}, #{cnts}
    </select>

    <select id="selectCountAll">
        SELECT COUNT(*)
          FROM zzim
         WHERE userId = #{userId}
    </select>

    <select id="zzimCheck" resultType="com.project.childprj.domain.Zzim">
        SELECT *
          FROM zzim
         WHERE userId = #{userId}
           AND togetherId = #{togetherId}
    </select>

    <insert id="insertZzim" flushCache="true" parameterType="com.project.childprj.domain.Zzim"
            useGeneratedKeys="true" keyColumn="id" keyProperty="id">
        INSERT INTO zzim(userId, togetherId)
        VALUES (#{userId}, #{together.id})
    </insert>

    <delete id="deleteZzim" flushCache="true" parameterType="com.project.childprj.domain.Zzim">
        DELETE
          FROM zzim
         WHERE userId = #{userId}
           AND togetherId = #{togetherId};
    </delete>

</mapper>
